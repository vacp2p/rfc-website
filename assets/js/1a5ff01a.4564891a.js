"use strict";(self.webpackChunklogos_docs_template=self.webpackChunklogos_docs_template||[]).push([[5479],{44882:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>p,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var n=s(87462),r=(s(67294),s(3905));const o={title:"46/GOSSIPSUB-TOR-PUSH",name:"Gossipsub Tor Push",status:"raw",category:"Standards Track",editor:"Daniel Kaiser <danielkaiser@status.im>",contributors:null},a=void 0,i={unversionedId:"46/gossipsub-tor-push",id:"46/gossipsub-tor-push",title:"46/GOSSIPSUB-TOR-PUSH",description:"- Status: raw",source:"@site/vac/46/gossipsub-tor-push.md",sourceDirName:"46",slug:"/46/gossipsub-tor-push",permalink:"/vac/46/gossipsub-tor-push",draft:!1,tags:[],version:"current",frontMatter:{title:"46/GOSSIPSUB-TOR-PUSH",name:"Gossipsub Tor Push",status:"raw",category:"Standards Track",editor:"Daniel Kaiser \\<danielkaiser@status.im\\>",contributors:null},sidebar:"defaultSidebar",previous:{title:"32/RLN-V1",permalink:"/vac/32/rln-v1"},next:{title:"48/RLN-INTEREP-SPEC",permalink:"/vac/48/rln-interep-spec"}},p={},l=[{value:"Abstract",id:"abstract",level:2},{value:"Background",id:"background",level:2},{value:"Functional Operation",id:"functional-operation",level:2},{value:"Specification",id:"specification",level:2},{value:"Wire Format",id:"wire-format",level:3},{value:"Receiving Tor Push Messages",id:"receiving-tor-push-messages",level:3},{value:"Sending Tor Push Messages",id:"sending-tor-push-messages",level:3},{value:"Connection Establishment",id:"connection-establishment",level:4},{value:"Epochs",id:"epochs",level:4},{value:"Security/Privacy Considerations",id:"securityprivacy-considerations",level:2},{value:"Fingerprinting Attacks",id:"fingerprinting-attacks",level:3},{value:"DoS",id:"dos",level:3},{value:"General DoS against Tor",id:"general-dos-against-tor",level:4},{value:"Targeting the Guard",id:"targeting-the-guard",level:4},{value:"Targeting the Gossipsub Network",id:"targeting-the-gossipsub-network",level:4},{value:"Peer Discovery",id:"peer-discovery",level:4},{value:"Roll-out Phase",id:"roll-out-phase",level:3},{value:"Copyright",id:"copyright",level:2},{value:"References",id:"references",level:2}],c={toc:l};function u(e){let{components:t,...s}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Status: raw"),(0,r.kt)("li",{parentName:"ul"},"Category: Standards Track"),(0,r.kt)("li",{parentName:"ul"},"Editor: Daniel Kaiser \\",(0,r.kt)("a",{parentName:"li",href:"mailto:danielkaiser@status.im%5C"},"danielkaiser@status.im\\"))),(0,r.kt)("h2",{id:"abstract"},"Abstract"),(0,r.kt)("p",null,"This document extends the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/README"},"libp2p gossipsub specification"),"\nspecifying gossipsub Tor Push,\na gossipsub-internal way of pushing messages into a gossipsub network via Tor.\nTor Push adds sender identity protection to gossipsub."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Protocol identifier"),": /meshsub/1.1.0"),(0,r.kt)("p",null,"Note: Gossipsub Tor Push does not have a dedicated protocol identifier.\nIt uses the same identifier as gossipsub and works with all ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/libp2p/specs/tree/master/pubsub"},"pubsub")," based protocols.\nThis allows nodes that are oblivious to Tor Push to process messages received via Tor Push."),(0,r.kt)("h2",{id:"background"},"Background"),(0,r.kt)("p",null,"Without extensions, ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/README"},"libp2p gossipsub"),"\ndoes not protect sender identities."),(0,r.kt)("p",null,"A possible design of an anonymity extension to gossipsub is pushing messages through an anonymization network before they enter the gossipsub network.\n",(0,r.kt)("a",{parentName:"p",href:"https://www.torproject.org/"},"Tor")," is currently the largest anonymization network.\nIt is well researched and works reliably.\nBasing our solution on Tor both inherits existing security research, as well as allows for a quick deployment."),(0,r.kt)("p",null,"Using the anonymization network approach, even the first gossipsub node that relays a given message cannot link the message to its sender (within a relatively strong adversarial model).\nTaking the low bandwidth overhead and the low latency overhead into consideration, Tor offers very good anonymity properties."),(0,r.kt)("h2",{id:"functional-operation"},"Functional Operation"),(0,r.kt)("p",null,"Tor Push allows nodes to push messages over Tor into the gossipsub network.\nThe approach specified in this document is fully backwards compatible.\nGossipsub nodes that do not support Tor Push can receive and relay Tor Push messages,\nbecause Tor Push uses the same Protocol ID as gossipsub."),(0,r.kt)("p",null,"Messages are sent over Tor via ",(0,r.kt)("a",{parentName:"p",href:"https://www.rfc-editor.org/rfc/rfc1928"},"SOCKS5"),".\nTor Push uses a dedicated libp2p context to prevent information leakage.\nTo significantly increase resilience and mitigate circuit failures,\nTor Push establishes several connections, each to a different randomly selected gossipsub node."),(0,r.kt)("h2",{id:"specification"},"Specification"),(0,r.kt)("p",null,"This section specifies the format of Tor Push messages, as well as how Tor Push messages are received and sent, respectively."),(0,r.kt)("h3",{id:"wire-format"},"Wire Format"),(0,r.kt)("p",null,"The wire format of a Tor Push message corresponds verbatim to a typical ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/libp2p/specs/tree/master/pubsub#the-message"},"libp2p pubsub message"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"message Message {\n  optional string from = 1;\n  optional bytes data = 2;\n  optional bytes seqno = 3;\n  required string topic = 4;\n  optional bytes signature = 5;\n  optional bytes key = 6;\n}\n")),(0,r.kt)("h3",{id:"receiving-tor-push-messages"},"Receiving Tor Push Messages"),(0,r.kt)("p",null,"Any node supporting a protocol with ID ",(0,r.kt)("inlineCode",{parentName:"p"},"/meshsub/1.1.0")," (e.g. gossipsub), can receive Tor Push messages.\nReceiving nodes are oblivious to Tor Push and will process incoming messages according to the respective ",(0,r.kt)("inlineCode",{parentName:"p"},"meshsub/1.1.0")," specification."),(0,r.kt)("h3",{id:"sending-tor-push-messages"},"Sending Tor Push Messages"),(0,r.kt)("p",null,"In the following, we refer to nodes sending Tor Push messages as Tp-nodes (Tor Push nodes)."),(0,r.kt)("p",null,"Tp-nodes MUST setup a separate libp2p context, i.e. ",(0,r.kt)("a",{parentName:"p",href:"https://docs.libp2p.io/concepts/multiplex/switch/"},"libp2p switch"),",\nwhich MUST NOT be used for any purpose other than Tor Push.\nWe refer to this context as Tp-context.\nThe Tp-context MUST NOT share any data, e.g. peer lists, with the default context."),(0,r.kt)("p",null,"Tp-peers are peers a Tp-node plans to send Tp-messages to.\nTp-peers MUST support ",(0,r.kt)("inlineCode",{parentName:"p"},"/meshsub/1.1.0"),".\nFor retrieving Tp-peers, Tp-nodes SHOULD use an ambient peer discovery method that retrieves a random peer sample (from the set of all peers), e.g. ",(0,r.kt)("a",{parentName:"p",href:"../../waku/standards/core/33/discv5"},"33/WAKU2-DISCV5"),"."),(0,r.kt)("p",null,"Tp-nodes MUST establish a connection as described in sub-section ",(0,r.kt)("a",{parentName:"p",href:"#connection-establishment"},"Tor Push Connection Establishment")," to at least one Tp-peer.\nTo significantly increase resilience, Tp-nodes SHOULD establish Tp-connections to ",(0,r.kt)("inlineCode",{parentName:"p"},"D")," peers,\nwhere ",(0,r.kt)("inlineCode",{parentName:"p"},"D")," is the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/gossipsub-v1.0##parameters"},"desired gossipsub out-degree"),",\nwith a default value of ",(0,r.kt)("inlineCode",{parentName:"p"},"8"),"."),(0,r.kt)("p",null,"Each Tp-message MUST be sent via the Tp-context over at least one Tp-connection.\nTo increase resilience, Tp-messages SHOULD be sent via the Tp-context over all available Tp-connections."),(0,r.kt)("p",null,"Control messages of any kind, e.g. gossipsub graft, MUST NOT be sent via Tor Push."),(0,r.kt)("h4",{id:"connection-establishment"},"Connection Establishment"),(0,r.kt)("p",null,"Tp-nodes establish a ",(0,r.kt)("inlineCode",{parentName:"p"},"/meshsub/1.1.0")," connection to tp-peers via ",(0,r.kt)("a",{parentName:"p",href:"https://www.rfc-editor.org/rfc/rfc1928"},"SOCKS5")," over ",(0,r.kt)("a",{parentName:"p",href:"https://www.torproject.org/"},"Tor"),"."),(0,r.kt)("p",null,"Establishing connections, which in turn establishes the respective Tor circuits, can be done ahead of time."),(0,r.kt)("h4",{id:"epochs"},"Epochs"),(0,r.kt)("p",null,"Tor Push introduces epochs.\nThe default epoch duration is 10 minutes.\n(We might adjust this default value based on experiments and evaluation in future versions of this document.\nIt seems a good trade-off between traceablity and circuit building overhead.)"),(0,r.kt)("p",null,"For each epoch, the Tp-context SHOULD be refreshed, which includes"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"libp2p peer-ID"),(0,r.kt)("li",{parentName:"ul"},"Tp-peer list"),(0,r.kt)("li",{parentName:"ul"},"connections to Tp-peers")),(0,r.kt)("p",null,"Both Tp-peer selection for the next epoch and establishing connections to the newly selected peers SHOULD be done during the current epoch\nand be completed before the new epoch starts.\nThis avoids adding latency to message transmission."),(0,r.kt)("h2",{id:"securityprivacy-considerations"},"Security/Privacy Considerations"),(0,r.kt)("h3",{id:"fingerprinting-attacks"},"Fingerprinting Attacks"),(0,r.kt)("p",null,"Protocols that feature distinct patterns are prone to fingerprinting attacks when using them over Tor Push.\nBoth malicious guards and exit nodes could detect these patterns\nand link the sender and receiver, respectively, to transmitted traffic.\nAs a mitigation, such protocols can introduce dummy messages and/or padding to hide patterns."),(0,r.kt)("h3",{id:"dos"},"DoS"),(0,r.kt)("h4",{id:"general-dos-against-tor"},"General DoS against Tor"),(0,r.kt)("p",null,"Using untargeted DoS to prevent Tor Push messages from entering the gossipsub network would cost vast resources,\nbecause Tor Push transmits messages over several circuits and the Tor network is well established."),(0,r.kt)("h4",{id:"targeting-the-guard"},"Targeting the Guard"),(0,r.kt)("p",null,"Denying the service of a specific guard node blocks Tp-nodes using the respective guard.\nTor guard selection will replace this guard ","[TODO elaborate]",".\nStill, messages might be delayed during this window which might be critical to certain applications."),(0,r.kt)("h4",{id:"targeting-the-gossipsub-network"},"Targeting the Gossipsub Network"),(0,r.kt)("p",null,"Without sophisticated rate limiting (for example using ",(0,r.kt)("a",{parentName:"p",href:"../../waku/standards/core/17/rln-relay"},"17/WAKU2-RLN-RELAY"),"),\nattackers can spam the gossipsub network.\nIt is not enough to just block peers that send too many messages,\nbecause these messages might actually come from a Tor exit node that many honest Tp-nodes use.\nWithout Tor Push, protocols on top of gossipsub could block peers if they exceed a certain message rate.\nWith Tor Push, this would allow the reputation-based DoS attack described in\n",(0,r.kt)("a",{parentName:"p",href:"https://ieeexplore.ieee.org/abstract/document/7163022"},"Bitcoin over Tor isn't a Good Idea"),"."),(0,r.kt)("h4",{id:"peer-discovery"},"Peer Discovery"),(0,r.kt)("p",null,"The discovery mechanism could be abused to link requesting nodes to their Tor connections to discovered nodes.\nAn attacker that controls both the node that responds to a discovery query,\nand the node who\u2019s ENR the response contains,\ncan link the requester to a Tor connection that is expected to be opened to the node represented by the returned ENR soon after."),(0,r.kt)("p",null,"Further, the discovery mechanism (e.g. discv5) could be abused to distribute disproportionately many malicious nodes.\nFor instance if p% of the nodes in the network are malicious,\nan attacker could manipulate the discovery to return malicious nodes with 2p% probability.\nThe discovery mechanism needs to be resilient against this attack."),(0,r.kt)("h3",{id:"roll-out-phase"},"Roll-out Phase"),(0,r.kt)("p",null,"During the roll-out phase of Tor Push, during which only a few nodes use Tor Push,\nattackers can narrow down the senders of Tor messages to the set of gossipsub nodes that do not originate messages.\nNodes who want anonymity guarantees even during the roll-out phase can use separate network interfaces for their default context and Tp-context, respectively.\nFor the best protection, these contexts should run on separate physical machines."),(0,r.kt)("h2",{id:"copyright"},"Copyright"),(0,r.kt)("p",null,"Copyright and related rights waived via ",(0,r.kt)("a",{parentName:"p",href:"https://creativecommons.org/publicdomain/zero/1.0/"},"CC0"),"."),(0,r.kt)("h2",{id:"references"},"References"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/README"},"libp2p gossipsub")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/tree/master/pubsub"},"libp2p pubsub")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/tree/master/pubsub#the-message"},"libp2p pubsub message")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.libp2p.io/concepts/multiplex/switch"},"libp2p switch")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.rfc-editor.org/rfc/rfc1928"},"SOCKS5")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.torproject.org/"},"Tor")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../../waku/standards/core/33/discv5"},"33/WAKU2-DISCV5")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://ieeexplore.ieee.org/abstract/document/7163022"},"Bitcoin over Tor isn't a Good Idea")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../../waku/standards/core/17/rln-relay"},"17/WAKU2-RLN-RELAY"))))}u.isMDXComponent=!0},3905:(e,t,s)=>{s.d(t,{Zo:()=>c,kt:()=>d});var n=s(67294);function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function o(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function a(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?o(Object(s),!0).forEach((function(t){r(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):o(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function i(e,t){if(null==e)return{};var s,n,r=function(e,t){if(null==e)return{};var s,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)s=o[n],t.indexOf(s)>=0||(r[s]=e[s]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)s=o[n],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}var p=n.createContext({}),l=function(e){var t=n.useContext(p),s=t;return e&&(s="function"==typeof e?e(t):a(a({},t),e)),s},c=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var s=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),h=l(s),d=r,g=h["".concat(p,".").concat(d)]||h[d]||u[d]||o;return s?n.createElement(g,a(a({ref:t},c),{},{components:s})):n.createElement(g,a({ref:t},c))}));function d(e,t){var s=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=s.length,a=new Array(o);a[0]=h;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:r,a[1]=i;for(var l=2;l<o;l++)a[l]=s[l];return n.createElement.apply(null,a)}return n.createElement.apply(null,s)}h.displayName="MDXCreateElement"}}]);